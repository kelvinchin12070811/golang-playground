# Golang Playground

Golang Playground is an isolated environment for building, testing, and playing around with [go](https://go.dev). With
environment preconfigured, writing code is simply starting the container, and connect your vs code to the created
tunnel.

This playground is based on [Rust Playground](https://github.com/kelvinchin12070811/rust-playground), a sandbox
environment for running Rust code. But this time for Golang, and try with a different approach
([tmpfs](https://docs.docker.com/engine/storage/tmpfs/)).

## Installation

To get started, docker is required to be installed on the host machine that we planed to host it on. Then, follow the
following steps to spin up the container. And a GitHub account is required to connect the tunnel to the cloud so we can
access it.

1. Clone this repo into your machine and cd into it.

```bash
git clone https://github.com/kelvinchin12070811/golang-playground
cd golang-playground
```

2. Build the docker image.

```bash
docker build -t <your_tag_here>/golang-playground:latest .
```

3. Run the docker image.

Once the image has build, we can then spin up the image as bellow:

Bash/ zsh:

```bash
docker run /
-d /
-h <name you want the vs code tunnel be> /
--tmpfs /home/playground /
--volume "<vs code binary data>:/root/.vscode" /
--volume "<vs code server data>:/root/.vscode-server" /
--name <name for the container> /
<your_tag_here>/golang-playground:latest
```

example:

```bash
docker run /
-d /
-h golang-playground /
--tmpfs /home/playground /
--volume "~/documents/golang-playground/.vscode:/root/.vscode" /
--volume "~/documents/golang-playground/.vscode-server:/root/.vscode-server" /
--name golang-playground /
kelvinchin1207/golang-playground:latest
```

This will require 3 docker volumes to store the following data:

- Playground workspace - The main location to store your code and will be wiped when the container is restarted. This is
  mounted as a tmpfs volume, so it will be wiped when the container is stopped.
- .vscode folder - This is where the server version of vs code will be installed, also with the tunnel authentication
  token.
- .vscode-server - This is the folder where vs code used to store the server side data such as extensions.

Or use docker compose for easier spin up, to run with sample docker-compose config, run:

```bash
docker compose up -d
```

To stop the example compose stacks:

```bash
docker compose down
```

Refer the docker-compose.yaml file in the repo for reference.

4. Authenticate the tunnel for first time use

Once the container is started, we will need to authorize the tunnel to allow it to be accessed from the vs code or
remotely from [vscode.dev](https://vscode.dev).

We first tail the docker log to get the auth link generated by the vscode cli tool.

```bash
docker logs -n 50 your-container-tunnel
```

We will get the following:

```
*
* Visual Studio Code Server
*
* By using the software, you agree to
* the Visual Studio Code Server License Terms (https://aka.ms/vscode-server-license) and
* the Microsoft Privacy Statement (https://privacy.microsoft.com/en-US/privacystatement).
*
To grant access to the server, please log into https://github.com/login/device and use code ****-****
```

Follow the instruction on the screen and login to the given link, we will need to login to our github account and
authorize the connection.

Once again, run the following command again:

```bash
docker logs -n 50 your-container-tunnel
```

We will get output as bellow:

```
[2023-01-01 05:20:30] info Creating tunnel with the name: <the-assigned-name-of-your-tunnel>

Open this link in your browser https://vscode.dev/tunnel/<the-assigned-name-of-your-tunnel>
```

Now we can access to the tunnel via the link given. We can also able to access the tunnel via vs code's remote
development extension or from [vscode.dev](https://vscode.dev). Login to the same github account on prompt and we are
ready to rock it.

As the docker file pull the Go image via the latest tag, to update the Go version, simply rebuild the image and
redeploy it. VS Code cli should updated by it self when needed.

## Usage

The folder we going to write our Go code is at `/home/playground`. Once finished with the mock, just restart the
container to clean up the playground and restore it to initial state. This is a dangerous command so please backup any
things that might be needed after. But if do not want this behaviour, just persist the volume `/home/playground`, or not
to mount it at all and use `docker compose down && docker compose up -d` to recreate the container. If deploy with
[Portainer](https://www.portainer.io), this should be easy as a click.

## Credit

This container did get some reference from the article
[Run VS Code Remote Tunnels in a container](https://dev.to/codingalex/run-vs-code-remote-tunnels-in-a-container-4lf4)
by Anh Dang on setting up the vs code cli in the container. You may refer to the article on the details on how to setup
a container with vscode tunnel.
